<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<title>项目管理</title>
<link href="../lib/css/public.css" type="text/css" rel="stylesheet" />
<link href="lib/css/common.css" type="text/css" rel="stylesheet" />
<script type="text/javascript" src="../lib/javascript/jquery-1.9.1.min.js"></script>
<script type="text/javascript" src="lib/javascript/index.js"></script>
<script type="text/javascript" src="lib/javascript/common.js"></script>
</head>

<body class="bodyBack">

<!-- Start of toppart -->
<div id="banner" class="fontLeft com-top toDiv">
</div>
<!-- End of toppart -->


<!-- Start of con -->
<div class="comMarginTop01 fontLeft">
	<table width="100%" border="0" cellspacing="0" cellpadding="0">
      <tr>
        <td align="left" valign="top" class="menu-left" id="memuFrame">
        	
        	<div class="menu-line"></div>
            <div class="menu-c" id="navTree">
            </div>
        </td>
        <td align="left" valign="top" class="com-right">
        	<div class="com-rightPosition">
        	<div class="com-optionMenu"><a class="closeMenu" id="setMenuFrame" title="打开菜单"><i></i></a></div>
        	<div class="com-tit" style="display:none;"><font>个人信息</font><em>/</em><b>User Message</b></div>
            <div class=" com-userDel">
            	
                <div class="com-userDel-ik">
                	<h5>${(userContact.Name)!}</h5>
                	<p class="green"><i class="com-pics dw"></i><label>组织：</label>${(userContact.CorpName)!}</p>
                    <p><span><i class="com-pics bm"></i><label>部门：</label>${(userContact.DeptName)!}</span></p>
                    <p><span><i class="com-pics zw"></i><label>职务：</label>${(userContact.PosName)!}</span></p>
                </div>
                <div class="com-in">
                	<#list projectSummary as ps>
                		<#switch ps.type>
  							<#case "processing">
							    <div class="com-info mes"><a href="index"><p class="com-info-ic"><b><i class="com-icons"></i></b></p><p class="com-info-num">${(ps.count)!}</p><font>待处理项目</font></a></div>
							    <#break>
  							<#case "library">
	  							<div class="com-info xt"><a href="library"><p class="com-info-ic"><b><i class="com-icons"></i></b></p><p class="com-info-num">${(ps.count)!}</p><font>项目库</font></a></div>
							    <#break>
  							<#default>
						</#switch>
                	</#list>
                </div>
                
            </div>
            
            <div class="com-member">
            	<div class="com-member-tit">
                	<font><a class="red">项目库</a></font>
                    <span>
                    <table border="0" cellspacing="0" cellpadding="0">
                      <tr>
                        <td style="padding-right:5px;"><link href="../widget/select/css/select.css" type="text/css" rel="stylesheet" />
						<script type="text/javascript" src="../widget/select/javascript/select.js"></script>
                    	<select name="" id="condition">
                	  	<option>编号</option>
                	  	<option>发起人</option>
               	  		</select>
                  		<script type="text/javascript">
	                  		var condition = document.getElementById("condition");	
							var conditionSelect = new select();
							conditionSelect.SetOptions({
								width: 101,
								handler:condition,
								isClick:true,
								tipTitle:"您选择查询条件！"
							});
							conditionSelect.render();
                  		</script>
                  		</td>
                        <td><input name="" type="text" class="com-tabInput inputWidth01 strInput"  value="查询条件"/>&nbsp;<button class="com-lookBtn">查询</button></td>
                      </tr>
                    </table>
                    
                  </span>
                </div>
            	<table id="projectList" width="100%" border="0" cellspacing="1" cellpadding="0" class="member-tab">
                </table>
				<div class="com-member-list-page"><span><a onclick="pageLast()" class="last"><i></i></a><b id="pageInfo"><em>0</em>/0</b><a onclick="pageNext()" class="next"><i></i></a></span><font><input name="" type="text" /><a>跳转</a></font></div>
            </div>
            </div>
        </td>
      </tr>
    </table>
</div>
<!-- End of con -->

<!-- Start of footer -->
<div id="footer" class="comMarginTop01 com-footer">
</div>
<!-- End of footer -->
<script type="text/javascript">
		
	var pageNumber=1;
	var pageSize=5;
	var totalPage=1;

	$(function() {
		$("#banner").load("../banner?navInfo=a,12");
		$("#navTree").load("../navTree?navInfo=a,12");
		$("#footer").load("../footer");
		$("#memuFrame").hide();
		getProject();
	});
	
	function getProject(){
		$.ajax({
            url: "../business/getProjectList",
            type: "GET",
            dataType: "json",
            data: {
            	pageNumber: pageNumber,
				pageSize: pageSize
            	},
            success: function(data) {
				//列表信息
				var projectList='<tr><th width="9%">项目编号</th><th width="10%">发起人</th><th width="15%">项目名称</th><th width="13%">发起时间</th><th width="15%">客户名称</th><th width="13%">最后处理时间</th><th width="10%">当前处理状态</th><th>所属分公司</th></tr>';
				for(var i=0;i<data.list.length;i++){
					projectList+='<tr onclick="queryProject(this)" c-id="'+data.list[i].CoordinateID+'">';
					projectList+='<td><span class="red">'+data.list[i].Code+'</span></td>';
					projectList+='<td>'+data.list[i].Caption+'</td><td>'+data.list[i].Name+'</td>';
					projectList+='<td>'+data.list[i].AddTime+'</td><td>'+data.list[i].ClientName+'</td>';
					projectList+='<td>'+"处理时间"+'</td><td>'+"节点名称"+'</td>';
					projectList+='<td>'+"所属分公司"+'</td>';
					projectList+='</tr>';
				}
				$("#projectList").html(projectList);
            	
            	//分页信息
            	totalPage = data.totalPage;
            	pageNumber = data.pageNumber;
            	var pageInfo = '<em>'+data.pageNumber+'</em>/'+data.totalPage;
				$("#pageInfo").html(pageInfo);
            },
           	error: function (jqXHR, textStatus, errorThrown) {
                alert(jqXHR.responseText);
            }
        });
	}
	
	function pageNext(){
		if(pageNumber>=totalPage)
			return;
		pageNumber++;
		getProject();
	}
	
	function pageLast(){
		if(pageNumber<=1)
			return;			
		pageNumber--;
		getProject();
	}
	
	function queryProject(obj){
		var coordinateID=$(obj).attr("c-id");
		var nodeID=0;
		window.open("../business/handlePorject?action=complete&coordinateID="+coordinateID+"&nodeID="+nodeID, "_self", "");
	}
</script>
</body>
</html>
