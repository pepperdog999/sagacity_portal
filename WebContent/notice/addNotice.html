<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<title>新建提醒</title>
<link href="../lib/css/public.css" type="text/css" rel="stylesheet" />
<link href="lib/css/common.css" type="text/css" rel="stylesheet" />
<link href="../widget/frame/css/frame.css" type="text/css" rel="stylesheet" />

<script type="text/javascript" src="../lib/javascript/jquery-1.9.1.min.js"></script>
<script type="text/javascript" src="../widget/frame/javascript/createDialog.js"></script>
<script type="text/javascript" src="lib/javascript/index.js"></script>
<script type="text/javascript" src="lib/javascript/common.js"></script>
<script type="text/javascript" src="../widget/datepicker/javascript/adddate.js"></script>
</head>

<body class="bodyBack">

<!-- Start of toppart -->
<div id="banner" class="fontLeft com-top toDiv">
</div>
<!-- End of toppart -->


<!-- Start of con -->
<div class="comMarginTop01 fontLeft">
	<table width="100%" border="0" cellspacing="0" cellpadding="0">
      <tr>
        <td align="left" valign="top" class="menu-left" id="memuFrame">
        	
        	<div class="menu-line"></div>
            <div class="menu-c" id="navTree">
            </div>
        </td>
        <td align="left" valign="top" class="com-right">
        	<div class="com-rightPosition">
                <div class="com-optionMenu"><a class="closeMenu close" id="setMenuFrame" title="打开菜单"><i></i></a></div>
            	
                <div class="not-box">
                	<div class="not-li"><label>提醒时间：</label>
                		<input type="text" readonly="readonly" class="not-input" id="time" onclick="SelectDate(this,'yyyy-MM-dd hh:mm')" /><a class="process-icons time"></a></div>
                    <div class="not-li"><label>提醒人：</label>
                    	<ul class="upNameList" style="width:450px;" id="sendObject"></ul><a class="process-icons lxr bindDialog" data-type="user"></a>
                        <div class="userListMore" id="moreDiv"></div>
                    </div>
                    <div class="not-li"><textarea id="content" cols="" rows="" class="not-textarea">请填写提醒内容!</textarea></div>
                    <div class="not-li">
                    	<div class="not-bq" id="tag"><a class="red">联系</a><a class="blue">会面</a><a class="green">开会</a><a class="orange">完成任务</a><a class="red">解决问题</a>
                    	<a class="blue">取东西</a><a class="orange">带东西</a><a class="blue">重要日</a><a class="green">出门提醒</a><a class="red">聚会</a><a class="orange">购物</a><a class="red">上课</a><a class="blue">个人事务</a>
                    	</div>
                    </div>
                    <div class="not-btnb"><button onclick="addNotice()" class="com-lookBtn not-btn01 mr">添加</button><button class="not-btn02">取消</button></div>
                </div>
            </div>
        </td>
      </tr>
    </table>
</div>
<!-- End of con -->

<!-- Start of footer -->
<div id="footer" class="comMarginTop01 com-footer">
</div>
<!-- End of footer -->
<script type="text/javascript">
	
	var indexData=[];

	$(function() {
		$("#banner").load("../banner?navInfo=m,3");
		$("#navTree").load("../navTree?navInfo=m,3");
		$("#footer").load("../footer");
		$("#memuFrame").show();
		
		/*标签点击事件*/
		$("#tag a").each(function(){
			$(this).bind("click", function(){
				var tag = $(this).html();
				$("#content").val(tag);
			})	
		});
	});
	
	function checkData(){
		if($("#time").val()=='' || $("#time").val()==null){
			alert('请设置提醒时间！');
			return false;
		}else if ($("#content").val()=='' || $("#content").val()==null){
			alert('请设置提醒内容！');
			return false;
		}else if (indexData.length==0){
			alert('请设置提醒人！');
			return false;
		}
		return true;
	}
	
	function addNotice(){
		if(!checkData()){
			return;
		}
		$.ajax({
            url: "../notice/addNotice",
            type: "GET",
            dataType: "json",
            data: {
            	contents : $("#content").val(),
            	dateTime : $("#time").val(),
            	indexData : JSON.stringify(indexData)
            },
            success: function(data) {
            	$("#content").val("");
            	alert(data.Msg);
            }
		});
		
	}
	
	//人员选择确定
	function chooseUserConfirm(){
		var userList=document.getElementById("dialogIframe").contentWindow.submitLsit();
		
		var html1='';
		var html2='<ul class="upNameList reStyle">';
		for(var i=0;i<userList.length;i++){
			if(i<=5){
    			html1+='<li data-id="'+userList[i].ID+'" onclick="removeUser(this)"><b>'+userList[i].Name+'</b><i></i></li>';
			}else{
				html2+='<li data-id="'+userList[i].ID+'" onclick="removeUser(this)"><b>'+userList[i].Name+'</b><i></i></li>'
			}
    		var single = new Object();
    		single["Type"]=2;
			single["ID"]=userList[i].ID;
			single["Name"]=userList[i].Name;
			indexData.push(single);
		}
		html1+='<li onclick="more(this)" class="more"><a title="显示更多"></a></li>';
		html2+='</ul>'
    	$("#sendObject").html(html1);
		$("#moreDiv").html(html2);
	}
	
	function more(obj){
		if($(obj).hasClass("up")){
			$(obj).removeClass("up");
			$("#moreDiv").hide();
		}else{
			$(obj).addClass("up");
			$("#moreDiv").show();
		}
	}
	
	function removeUser(obj){
		if(indexData.length>1){
			for(var i=0;i<indexData.length;i++){
				if(indexData[i]["UserID"]==$(obj).attr("data-id")){
					indexData.splice(i,1);
				}
			}
			$(obj).remove();	
		}else{
			alert("不允许删除！");
		}
		
	}
</script>
</body>
</html>