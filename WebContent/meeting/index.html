<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<title>会议助手</title>
<link href="../lib/css/public.css" type="text/css" rel="stylesheet" />
<link href="lib/css/meeting.css" type="text/css" rel="stylesheet" />
<link href="../widget/frame/css/frame.css" type="text/css" rel="stylesheet" />

<script type="text/javascript" src="../lib/javascript/jquery-1.9.1.min.js"></script>
<script type="text/javascript" src="lib/javascript/initCal.js"></script>
<script type="text/javascript" src="lib/javascript/faceplate.js"></script>
<script type="text/javascript" src="lib/javascript/meeting.js"></script>
<script type="text/javascript" src="../widget/frame/javascript/createDialog.js"></script>
<script type="text/javascript" src="../lib/javascript/jquery.form.min.js"></script>
</head>

<body class="bodyBack">

<!-- Start of toppart -->
<div id="banner" class="fontLeft com-top toDiv">
</div>
<!-- End of toppart -->


<!-- Start of con -->
<div class="comMarginTop01 fontLeft">
	<table width="100%" border="0" cellspacing="0" cellpadding="0">
      <tr>
        <td align="left" valign="top" class="menu-left" id="memuFrame">
        	
        	<div class="menu-line"></div>
            <div class="menu-c" id="navTree">
            </div>
        </td>
        <td align="left" valign="top" class="com-right">
        	<div class="com-rightPosition">
            	<div class="com-optionMenu"><a class="returnHome" title="返回主页" href="index" hidefocus="true"><i></i></a><a class="closeMenu close" id="setMenuFrame" title="打开菜单"><i></i></a></div>
        		<div class="com-member">
                	<div  class="meet-ti">
                		<font><a class="prev" href="javascript:monthLast()" title="上一月"></a><b id="calTitle"></b><a class="next" href="javascript:monthNext()" title="下一月"></a></font>
                    	<span><a title="新建会议" href="#" onclick="addMeeting()"><i class="com-icons"></i>新建会议</a></span>
                    </div>
                    <div class="meet-k">
                    	<table class="meet-tab" id="dateTable">
                          
                        </table>
                  </div>
                </div>
            </div>
        </td>
      </tr>
    </table>
</div>
<!-- End of con -->

<!-- Start of footer -->
<div id="footer" class="comMarginTop01 com-footer">
</div>
<!-- End of footer -->
<script type="text/javascript">
	
	var nowDate = "";
	
	$(function() {
		$("#banner").load("../banner?navInfo=a,13");
		$("#navTree").load("../navTree?navInfo=a,13");
		$("#footer").load("../footer");
		$("#memuFrame").show();
		
		//初始化日历年月
		nowDate ="${(nowDate)!}";
		initMeetingCal();
		
	});
	
	function initMeetingCal(){
		$("#calTitle").html(nowDate.substr(0,4)+"年"+nowDate.substr(5,2)+"月");
		var initDate = nowDate.substr(0,7)+"-01";
		$("#dateTable").initCal({thisDate:initDate});
		
		//查找界面的第一个日历元素和最后一个日历元素
		var firstDay = $("#dateTable").find(".meet-tab-x:first").attr("data-thisdate");
		var lastDay = $("#dateTable").find(".meet-tab-x:last").attr("data-thisdate");
		$.ajax({
            url: "../meeting/getMeetingList",
            type: "GET",
            dataType: "json",
            data: {
            	firstDay: firstDay,
            	lastDay: lastDay,
            	},
            success: function(data) {
            	if(data.list.length>0){
            		var initMeetingDate=data.list[0].MeetingDate;
                	var content = '<div style="padding-bottom:5px"><a data-id="'+data.list[0].MeetingID+'" class="openDeal">'+data.list[0].MeetingContent+'</a></div>';	
                	for(var i=0;i<data.list.length;i++){
                		var type = data.list[i].MarkImportantTime == '' ? 1 : 2;
                		if(data.list[i].MeetingDate != initMeetingDate){
                			setCellContent(data.list[i].MeetingDate,content,type);
                			initMeetingDate = data.list[i].MeetingDate;
                			content = '<div style="padding-bottom:5px"><a data-id="'+data.list[i].MeetingID+'" class="openDeal">'+data.list[i].MeetingContent+'</a></div>';	
                		}else if(i>0){
                			content += '<div style="padding-bottom:5px"><a data-id="'+data.list[i].MeetingID+'" class="openDeal">'+data.list[i].MeetingContent+'</a></div>';	
                		}
        				setCellContent(data.list[i].MeetingDate,content,type);
                	}
                	setMeetingListLink();	
            	}
            }
		});
	}
	
	function addMeeting(){
		var HtmlElement = createDivElement("addmeeting.html");
		var Myfaceplate = new faceplate({
				width:"700",					
				height:"777",
				top:"118"
			});
		Myfaceplate.render(HtmlElement);
		return false;
	}
	
	function monthLast(){
		var dt = new Date(nowDate);
		dt.setMonth(dt.getMonth()-1,1);
		var m = Number(dt.getMonth())+1 <10 ? '0'+(Number(dt.getMonth())+1) : Number(dt.getMonth())+1; 
		nowDate= dt.getFullYear()+"-"+m+"-01";
		initMeetingCal();
	}
	
	function monthNext(){
		var dt = new Date(nowDate);
		dt.setMonth(dt.getMonth()+1,1);
		var m = Number(dt.getMonth())+1 <10 ? '0'+(Number(dt.getMonth())+1) : Number(dt.getMonth())+1; 
		nowDate =  dt.getFullYear()+"-"+m+"-01";
		initMeetingCal();
	}
</script>
</body>
</html>
